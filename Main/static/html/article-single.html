
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>article-single</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="static/img/favicon.png" rel="icon">
  <link href="static/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="static/vendor/aos/aos.css" rel="stylesheet">
  <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="static/css/style.css" rel="stylesheet">
  <style>
  /* 左边侧边栏 */
  .sidebar-left {
    padding-right: 15px; /* 与文章内容保持间距 */
  }

  /* 右边侧边栏 */
  .sidebar-right {
    padding-left: 15px; /* 与文章内容保持间距 */
  }

  /* 作者信息样式 */
  .author-info {
    border: 1px solid #eee;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
  }

  .author-info img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .author-info h3 {
    margin: 0;
    font-size: 16px;
  }

  .author-info p {
    margin: 0;
    font-size: 14px;
    color: #666;
  }

  .author-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }

  .author-stats div {
    text-align: center;
  }

  .author-stats p {
    margin: 0;
    font-size: 14px;
    font-weight: bold;
  }

  .author-stats small {
    font-size: 12px;
    color: #666;
  }
  .author-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }

  .author-stats div {
    text-align: center;
  }

  .author-stats p {
    margin: 0;
    font-size: 14px;
    font-weight: bold;
  }

  .author-stats small {
    font-size: 12px;
    color: #666;
  }

/*           */
    	  /* 文章点赞、踩和收藏按钮样式 */
	      .article-actions {
	        display: flex;
	        gap: 10px;
	        margin-top: 20px;
	      }

	      .article-actions .btn-like,
	      .article-actions .btn-dislike,
	      .article-actions .btn-favorite {
	        display: flex;
	        align-items: center;
	        gap: 5px;
	        padding: 8px 16px;
	        border: 1px solid #ddd; /* 文章点赞按钮有边框 */
	        border-radius: 4px;
	        background-color: #f8f9fa;
	        cursor: pointer;
	        transition: all 0.3s ease;
	      }

	      .article-actions .btn-like:hover,
	      .article-actions .btn-dislike:hover,
	      .article-actions .btn-favorite:hover {
	        background-color: #e9ecef;
			color: #0d6efd;
			transform: scale(1.1);
	      }

	      .article-actions .btn-like.active i {
	        color: #0d6efd;
			animation: like-pop 0.3s ease;
	      }

	      .article-actions .btn-dislike.active i {
	        color: #dc3545;
			animation: like-pop 0.3s ease;
	      }

	      .article-actions .btn-favorite.active i {
	        color: #ffc107;
			animation: like-pop 0.3s ease;
	      }

.comment-actions {
  display: flex;
  justify-content: flex-end; /* 将点赞和回复按钮居右 */
  gap: 10px; /* 设置按钮之间的间距 */
}
.comment-actions .btn-like {
  border: none !important; /* 评论点赞按钮无边框 */
  background: transparent !important;
  padding: 0.25rem 0.5rem !important;
}

.comment-actions .btn-like i {
  color: #6c757d;
  transition: color 0.2s ease-in-out;
}

.comment-actions .btn-like:hover i {
  color: #0d6efd;
  transform: scale(1.1);
}

.comment-actions .btn-like.active i {
  color: #0d6efd;
  animation: like-pop 0.3s ease;
}

.btn-reply {
  display: flex;
  align-items: center;
  gap: 5px; /* 设置图标和文字之间的间距 */
  padding: 5px 10px; /* 调整按钮内边距 */
  font-size: 14px; /* 调整按钮字体大小 */
  border: 1px solid #ddd; /* 添加边框 */
  border-radius: 4px; /* 添加圆角 */
  background-color: #f8f9fa; /* 设置背景色 */
  cursor: pointer;
}

.btn-reply:hover {
  background-color: #e9ecef; /* 设置悬停背景色 */
}

/* 提交回复按钮容器 */
.form-group.d-flex.justify-content-end {
  margin-top: 10px; /* 与文本域保持一定距离 */
}

.btn-reply:hover {
  background-color: #e9ecef; /* 设置悬停背景色 */
}
      .comment-form {
    position: relative;
  }

  .comment-form .form-group.text-right {
    text-align: right; /* 按钮右对齐 */
    margin-top: 10px; /* 与文本域保持一定距离 */
  }

  .comment-form .btn-sm {
    padding: 5px 15px; /* 缩小按钮内边距 */
    font-size: 14px; /* 缩小按钮字体大小 */
  }
  /* 基础评论样式 */
  .comment-item {
      width: 100%;
      min-height: 120px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-sizing: border-box;
      transition: all 0.3s ease;
  }

  /* 评论容器布局 */
  .comment-post-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 1.5rem;
  }

  /* 用户头像样式 */
  .user-avatar {
      position: relative;
      width: 40px;
      height: 40px;
      flex-shrink: 0;
  }

  .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
  }

  /* 评论内容区域 */
  .comment-content {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #eee;
      margin-left: 1rem;
      flex-grow: 1;
  }

  /* 评论头部信息 */
  .comment-header {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
  }

  .username {
      font-weight: 500;
      color: #333;
      margin-right: 8px;
  }

  .user-level {
      font-size: 0.8em;
      color: #fff;
      background: #6c757d;
      padding: 2px 5px;
      border-radius: 3px;
  }

  .comment-time {
      color: #999;
      font-size: 0.9em;
      margin-left: 10px;
  }

  /* 评论操作按钮 */
  .comment-actions .btn {
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.9em;
      transition: all 0.2s ease;
  }

  .btn-reply {
      color: #666;
  }

  /* 点赞和回复按钮样式 */
   .btn-reply {
      background: transparent !important;
      border: none !important;
      padding: 0.25rem 0.5rem !important;
      box-shadow: none !important;
  }

  /* 默认图标颜色 */
   .btn-reply i {
      color: #6c757d;
      transition: color 0.2s ease-in-out;
  }

  /* 悬停效果 */
  .btn-reply:hover i {
      color: #17a2b8;
      transform: scale(1.1);
  }

  /* 激活状态 */
  .btn-reply.active i {
      color: #17a2b8;
  }

  /* 数量文字样式 */
   .btn-reply span {
      margin-left: 0.3rem;
      font-size: 0.9em;
      color: #6c757d;
      vertical-align: middle;
  }

  /* 点赞动画 */
  @keyframes like-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
  }

  /* 聚焦状态移除轮廓 */
   .btn-reply:focus {
      outline: none;
      box-shadow: none;
  }
  /*子评论样式*/
  .child-comments.collapsible {
    max-height: 150px; /* 默认显示的高度 */
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .child-comments.collapsible.expanded {
    max-height: 5000px; /* 展开后的高度 */
  }

  .show-more-replies {
    margin-top: 10px;
    text-align: center;
  }

  .show-more-replies a {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    color: #00a1d6;
    font-size: 0.9em;
    transition: all 0.2s;
  }

  .show-more-replies i {
    transition: transform 0.3s;
  }

  .show-more-replies:hover a {
    color: #0077b3;
  }

  /*                         */
  .child-comments.collapsible {
    max-height: 150px; /* 默认显示的高度 */
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .child-comments.collapsible.expanded {
    max-height: 5000px; /* 展开后的高度 */
  }

  .show-more-replies {
    margin-top: 10px;
    text-align: center;
  }

  .show-more-replies a {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    color: #00a1d6;
    font-size: 0.9em;
    transition: all 0.2s;
  }

  .show-more-replies i {
    transition: transform 0.3s;
  }

  .show-more-replies:hover a {
    color: #0077b3;
  }
  .comment-actions {
    display: flex;
    justify-content: flex-end; /* 将点赞和回复按钮居右 */
    gap: 10px; /* 设置按钮之间的间距 */
  }

  .btn-reply {
    display: flex;
    align-items: center;
    gap: 5px; /* 设置图标和文字之间的间距 */
    padding: 5px 10px; /* 调整按钮内边距 */
    font-size: 14px; /* 调整按钮字体大小 */
    border: 1px solid #ddd; /* 添加边框 */
    border-radius: 4px; /* 添加圆角 */
    background-color: #f8f9fa; /* 设置背景色 */
    cursor: pointer;
  }

  .btn-reply:hover {
    background-color: #e9ecef; /* 设置悬停背景色 */
  }

  /* 提交回复按钮容器 */
  .form-group.d-flex.justify-content-end {
    margin-top: 10px; /* 与文本域保持一定距离 */
  }

  .btn-reply:hover {
    background-color: #e9ecef; /* 设置悬停背景色 */
  }

  .comment-form {
    position: relative;
  }

  .comment-form .form-group.text-right {
    text-align: right; /* 按钮右对齐 */
    margin-top: 10px; /* 与文本域保持一定距离 */
  }

  .comment-form .btn-sm {
    padding: 5px 15px; /* 缩小按钮内边距 */
    font-size: 14px; /* 缩小按钮字体大小 */
  }
  /* 基础评论样式 */
  .comment-item {
      width: 100%;
      min-height: 120px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-sizing: border-box;
      transition: all 0.3s ease;
  }

  /* 评论容器布局 */
  .comment-post-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 1.5rem;
  }

  /* 用户头像样式 */
  .user-avatar {
      position: relative;
      width: 40px;
      height: 40px;
      flex-shrink: 0;
  }

  .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
  }

  /* 评论内容区域 */
  .comment-content {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #eee;
      margin-left: 1rem;
      flex-grow: 1;
  }

  /* 评论头部信息 */
  .comment-header {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
  }

  .username {
      font-weight: 500;
      color: #333;
      margin-right: 8px;
  }

  .user-level {
      font-size: 0.8em;
      color: #fff;
      background: #6c757d;
      padding: 2px 5px;
      border-radius: 3px;
  }

  .comment-time {
      color: #999;
      font-size: 0.9em;
      margin-left: 10px;
  }

  /* 评论操作按钮 */
  .comment-actions .btn {
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.9em;
      transition: all 0.2s ease;
  }

  .btn-reply {
      color: #666;
  }
  /* 子评论系统 */
  .child-comments {
      margin-left: 40px;
      border-left: 2px solid #eee;
      padding-left: 1.5rem;
      overflow: hidden;
      transition: max-height 0.3s ease;
  }

  /* 展开状态 */
  .child-comments.expanded {
      max-height: 5000px; /* 足够显示所有内容的高度 */
  }

  /* 子评论项样式 */
  .child-comments .comment-item {
      margin-left: 0;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      opacity: 1;
      transition: opacity 0.3s ease;
  }

  /* 折叠时的细节优化 */
  .child-comments:not(.expanded) .comment-item:nth-child(n+2) {
      opacity: 0; /* 隐藏非首条评论的淡出效果 */
  }

  /* 展开/收起控制 */
  .show-more-replies {
      margin-top: 10px;
      text-align: center;
  }

  .show-more-replies a {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: #00a1d6;
      font-size: 0.9em;
      transition: all 0.2s;
  }

  .show-more-replies i {
      transition: transform 0.3s;
  }

  .show-more-replies:hover a {
      color: #0077b3;
  }

  /* 点赞和回复按钮样式 */
  .btn-reply {
      background: transparent !important;
      border: none !important;
      padding: 0.25rem 0.5rem !important;
      box-shadow: none !important;
  }

  /* 默认图标颜色 */
  .btn-reply i {
      color: #6c757d;
      transition: color 0.2s ease-in-out;
  }


  .btn-reply:hover i {
      color: #17a2b8;
      transform: scale(1.1);
  }

  .btn-reply.active i {
      color: #17a2b8;
  }

  /* 数量文字样式 */
  .btn-reply span {
      margin-left: 0.3rem;
      font-size: 0.9em;
      color: #6c757d;
      vertical-align: middle;
  }

  /* 点赞动画 */
  @keyframes like-pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
  }

  /* 聚焦状态移除轮廓 */
  .btn-like:focus, .btn-reply:focus {
      outline: none;
      box-shadow: none;
  }
  </style>
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex justify-content-between align-items-center" style="width: 1800px;">

  		<nav id="navbar" class="navbar" >
  		  <ul>
  		    <li><a href="index.html" style="font-size: 20px;padding-right: 25px;">首页</a></li>
  		    <li class="dropdown"><a href="#"  style="font-size: 20px;padding-right: 25px;"><span>服务</span> <i class="bi bi-chevron-down"></i></a>
  		      <ul>
  		        <li><a href="service_photo.html">图片检测</a></li>
  		        <li><a href="service_video.html">视频检测</a></li>
  		      </ul>
  		    </li>
  		    <li><a class="active" href="article.html" style="font-size: 20px;padding-right: 25px;">论坛</a></li>
  		    <li><a href="help.html" style="font-size: 20px;">帮助</a></li>
  		  </ul>
  		  <i class="bi bi-list mobile-nav-toggle"></i>
  		</nav><!-- .navbar -->

        <nav id="navbar" class="navbar">
          <ul>
            <li>
              <a href="#" style="font-size: 20px;" id="login-button">登录</a>
              <!-- 用户头像占位符 -->

                <li id="user-avatar" class="dropdown" style="display: none">
                <a href="#"  style="font-size: 20px;padding-right: 25px;"><img id="user-avatar_url" src="" alt="用户头像" style="width: 40px; height: 40px; border-radius: 50%;"><i class="bi bi-chevron-down"></i></a>
  		      <ul style="width:100px ">
  		        <li><a href="center.html" >个人中心</a></li>
  		        <li><a id='exit' href="#">退出登录</a></li>
  		      </ul>
  		    </li>

            </li>
          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Single Blog Section ======= -->
    <section class="hero-section inner-page">
      <div class="wave">

        <svg width="1920px" height="265px" viewBox="0 0 1920 265" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Apple-TV" transform="translate(0.000000, -402.000000)" fill="#FFFFFF">
              <path d="M0,439.134243 C175.04074,464.89273 327.944386,477.771974 458.710937,477.771974 C654.860765,477.771974 870.645295,442.632362 1205.9828,410.192501 C1429.54114,388.565926 1667.54687,411.092417 1920,477.771974 L1920,667 L1017.15166,667 L0,667 L0,439.134243 Z" id="Path"></path>
            </g>
          </g>
        </svg>

      </div>

      <div class="container">
        <div class="row align-items-center">
          <div class="col-12">
            <div class="row justify-content-center">
              <div class="col-md-10 text-center hero-text">
                <h1 data-aos="fade-up" data-aos-delay="" style="font-family: 'Times New Roman', Times, serif;">Chrome now alerts you when someone steals your password</h1>
                <p class="mb-5" data-aos="fade-up" data-aos-delay="100">December 13, 2019 &bullet; By <a href="#" class="text-white">Admin</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>

  <section class="site-section mb-4">
      <div class="container-fluid">
        <div class="row">
          <!-- 左边侧边栏 -->
          <div class="col-md-2 sidebar-left">
            <!-- 初始加载提示 -->
            <p>加载中...</p>
          </div>

          <!-- 文章内容 -->
          <div class="col-md-7 blog-content">
            <!-- 动态内容将在此插入 -->
          </div>

          <!-- 右边侧边栏 -->
          <div class="col-md-3 sidebar-right">
            <!-- 初始加载提示 -->
            <p>加载中...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ======= 评论区 ======= -->
    <section class="site-section">
      <div class="container-fluid" style="margin-left: 100px">
        <div class="row">
          <div class="col-md-10">
            <h3 class="mb-4">评论</h3>
            <!-- 评论列表 -->
            <div id="comments-list">
              <p>加载评论...</p>
            </div>
            <!-- 评论表单 -->
            <div class="comment-form">
              <h4>发表评论</h4>
              <form id="comment-form">
                <div class="form-group">
                  <textarea id="comment-content" class="form-control" placeholder="请输入评论内容" required></textarea>
                </div>
                <div class="form-group text-right"> <!-- 将按钮容器右对齐 -->
                  <button type="submit" class="btn btn-primary btn-sm">提交评论</button> <!-- 缩小按钮大小 -->
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ======= CTA Section ======= -->
    <section class="section cta-section">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6 me-auto text-center text-md-start mb-5 mb-md-0">
            <h2>Starts Publishing Your Apps</h2>
          </div>
          <div class="col-md-5 text-center text-md-end">
            <p><a href="#" class="btn d-inline-flex align-items-center"><i class="bx bxl-apple"></i><span>App store</span></a> <a href="#" class="btn d-inline-flex align-items-center"><i class="bx bxl-play-store"></i><span>Google play</span></a></p>
          </div>
        </div>
      </div>
    </section><!-- End CTA Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4 mb-md-0">
          <h3>About SoftLand</h3>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius ea delectus pariatur, numquam aperiam
            dolore nam optio dolorem facilis itaque voluptatum recusandae deleniti minus animi.</p>
          <p class="social">
            <a href="#"><span class="bi bi-twitter"></span></a>
            <a href="#"><span class="bi bi-facebook"></span></a>
            <a href="#"><span class="bi bi-instagram"></span></a>
            <a href="#"><span class="bi bi-linkedin"></span></a>
          </p>
        </div>
        <div class="col-md-7 ms-auto">
          <div class="row site-section pt-0">
            <div class="col-md-4 mb-4 mb-md-0">
              <h3>Navigation</h3>
              <ul class="list-unstyled">
                <li><a href="#">Pricing</a></li>
                <li><a href="#">Features</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Contact</a></li>
              </ul>
            </div>
            <div class="col-md-4 mb-4 mb-md-0">
              <h3>Services</h3>
              <ul class="list-unstyled">
                <li><a href="#">Team</a></li>
                <li><a href="#">Collaboration</a></li>
                <li><a href="#">Todos</a></li>
                <li><a href="#">Events</a></li>
              </ul>
            </div>
            <div class="col-md-4 mb-4 mb-md-0">
              <h3>Downloads</h3>
              <ul class="list-unstyled">
                <li><a href="#">Get from the App Store</a></li>
                <li><a href="#">Get from the Play Store</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row justify-content-center text-center">
        <div class="col-md-7">
          <p class="copyright">&copy; Copyright SoftLand. All Rights Reserved</p>

        </div>
      </div>

    </div>
  </footer>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="static/vendor/aos/aos.js"></script>
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="static/vendor/php-email-form/validate.js"></script>
  <script src="static/vendor/swiper/swiper-bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
        // 获取文章ID
        const urlParams = new URLSearchParams(window.location.search);
        const article_id = urlParams.get('article_id');

        // 页面元素引用
        const elements = {
            title: document.querySelector('.hero-text h1'),
            meta: document.querySelector('.hero-text .mb-5'),
            content: document.querySelector('.col-md-7.blog-content')
        };

        try {
          // 获取文章数据
          const data = await fetchArticleData(article_id);

          // 更新页面内容
          renderArticle(elements, data.article);

          // 渲染左边侧边栏
          renderLeftSidebar(document.querySelector('.sidebar-left'), data.article);

          // 渲染右边侧边栏
          renderSidebar(document.querySelector('.sidebar-right'), data.article);
        } catch (error) {
          // 错误处理
          document.querySelector('.sidebar-left').innerHTML = '<p>加载侧边栏内容失败，请稍后重试。</p>';
          document.querySelector('.sidebar-right').innerHTML = '<p>加载侧边栏内容失败，请稍后重试。</p>';
          handleError(elements, error);
        }

      // 加载评论数据
      try {
        const commentsData = await fetchComments(article_id);
        renderComments(document.getElementById('comments-list'), commentsData.comments);
      } catch (error) {
        console.error('加载评论失败:', error);
        document.getElementById('comments-list').innerHTML = '<p>加载评论失败，请稍后重试。</p>';
      }

      // 评论表单提交事件
      document.getElementById('comment-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const contentEl = document.getElementById('comment-content');
        const content = contentEl.value.trim();
        if (!content) return;
        try {
          const newComment = await postComment(article_id, content);
          // 追加到评论列表（假设新评论显示在最前面）
          prependComment(document.getElementById('comments-list'), newComment);
          contentEl.value = '';
        } catch (error) {
          console.error('发表评论失败:', error);
          alert('发表评论失败，请稍后重试。');
        }
      });
    });

    // 数据获取函数
    async function fetchArticleData(article_id) {
        try {
           // console.log(article_id)
           const response = await fetch(`/article/${article_id}`);
           result = await response.json();
           if (result.re_code !== RET.OK) throw new Error(`HTTP error! status: ${response.status}`);
           return result;
         } catch (error) {
           console.error('数据获取失败:', error);
           throw error; // 将错误传递给调用方
         }
    }

    // 渲染函数
    function renderArticle(elements, data) {
        // 更新标题
        elements.title.textContent = data.title;

        // 格式化日期
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
        const createDate = new Date(data.created_at).toLocaleDateString('zh-CN', dateOptions);

        // 更新元信息
        elements.meta.innerHTML = `${createDate} &bullet; 作者 <a href="#" class="text-white">${data.author.username}</a>`;
        // 生成内容HTML
        const contentHTML = `
          <div class="col-md-6" style="width: 100%; position: relative;">
          <!-- 文章图片 -->
          <figure style="margin: 0; height: 100%;">
            <img src=${data.show_image}
                 alt="Free Website Template by Free-Template.co"
                 class="img-fluid"
                 style="width: 100%; height: 100%; object-fit: cover;">
          </figure>

          <!-- 文章内容 -->
          <div class="article-content">${data.content}</div>

          <!-- 分类信息 -->
          <div class="pt-5">
            <p>分类：<a href="#">${data.category || '未分类'}</a></p>
          </div>

          <!-- 点赞按钮（右下角） -->
          <div class="article-actions" style="position: absolute; bottom: 10px; right: 20px;">
            <button class="btn btn-like" onclick="likeArticle()">
              <i class="bi bi-hand-thumbs-up"></i>
              <span id="like-count">0</span>
            </button>
            <button class="btn btn-dislike" onclick="dislikeArticle()">
              <i class="bi bi-hand-thumbs-down"></i>
              <span id="dislike-count">0</span>
            </button>
            <button class="btn btn-favorite" onclick="toggleFavorite()">
              <i class="bi bi-star"></i>
              <span id="favorite-text">收藏</span>
            </button>
          </div>
        </div>
        `;

        // 更新文章内容
        elements.content.innerHTML = contentHTML;
    }

    // 错误处理函数
    function handleError(elements, error) {
        console.error('Error:', error);
        elements.title.textContent = '加载错误';
        elements.content.innerHTML = `
            <div class="alert alert-danger">
                <h4>无法加载文章内容</h4>
                <p>错误信息：${error.message}</p>
                <a href="/article.html" class="btn btn-secondary">返回文章列表</a>
            </div>
        `;
    }

      // 渲染侧边栏内容函数，生成与静态侧边栏一致的 HTML 结构
      function renderSidebar(container, data) {
        let html = '';

        // 第二部分：Abstract
        if (data.abstract) {
          html += `
            <div class="sidebar-box">
              <h3>Abstract</h3>
              <p>${data.abstract}</p>
            </div>
          `;
        }

        // 第二部分：作者信息
		// if (data.author) {
		//   html += `
		//     <div class="sidebar-box" style="border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
		//       <div style="display: flex; align-items: center; margin-bottom: 15px;">
		//         <img src="${data.author.avatar}" alt="${data.author.username}" style="width: 60px; height: 60px; border-radius: 50%; margin-right: 10px;">
		//       </div>
		//       <div style="display: flex; justify-content: space-between;">
		//         <div style="text-align: center;">
		//           <p style="margin: 0; font-size: 14px; font-weight: bold;">${data.author.article_count}</p>
		//           <p style="margin: 0; font-size: 12px; color: #666;">文章数</p>
		//         </div>
		//         <div style="text-align: center;">
		//           <p style="margin: 0; font-size: 14px; font-weight: bold;">${data.author.total_likes}</p>
		//           <p style="margin: 0; font-size: 12px; color: #666;">点赞数</p>
		//         </div>
		//       </div>
		//     </div>
		//   `;
		// }

        // 第三部分：Categories（列表）
        if (data.categories && Array.isArray(data.categories)) {
          const categoriesHTML = data.categories.map(cat => `
            <li style="padding: 8px 0;"><a href="#">${cat.name} <span>(${cat.count})</span></a></li>
          `).join('');
          html += `
            <div class="sidebar-box">
              <div class="categories" style="max-height: 300px; overflow-y: auto;">
                <h3 style="position: sticky; top: 0; background: white; z-index: 1; padding: 10px 0;">Categories</h3>
                <ul style="list-style: none; padding: 0; margin: 0;">
                  ${categoriesHTML}
                </ul>
              </div>
            </div>
          `;
        }

        // 第四部分：Tags（列表）
        if (data.tags && Array.isArray(data.tags)) {
          const tagsHTML = data.tags.map(tag => `
            <li><a href="#">${tag.name} <span>(${tag.count})</span></a></li>
          `).join('');
          html += `
            <div class="sidebar-box">
              <div class="categories">
                <h3>Tags</h3>
                <ul style="list-style: none; padding: 0; margin: 0;">
                  ${tagsHTML}
                </ul>
              </div>
            </div>
          `;
        }

        // 第一部分：热门文章
        if (data.popularArticles && Array.isArray(data.popularArticles)) {
          const popularArticlesHTML = data.popularArticles.map(article => `
            <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
              <a href="${article.link}" style="display: flex; align-items: center; text-decoration: none; color: inherit;">
                <img src="${article.thumbnail}" alt="${article.title}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 10px;">
                <div>
                  <h4 style="margin: 0; font-size: 14px;">${article.title}</h4>
                  <p style="margin: 0; font-size: 12px; color: #666;">${article.views} 阅读 · ${article.likes} 点赞</p>
                </div>
              </a>
            </li>
          `).join('');
          html += `
            <div class="sidebar-box">
              <h3>热门文章</h3>
              <ul style="list-style: none; padding: 0; margin: 0;">
                ${popularArticlesHTML}
              </ul>
            </div>
          `;
        }

        container.innerHTML = html;
      }

    // 获取评论数据函数
    async function fetchComments(article_id) {
      try {
        const response = await fetch(`/article/comments/${article_id}`);
		const result = await response.json();
        if (result.re_code !== RET.OK) throw new Error(`HTTP error! status: ${response.status}`);
        return result;
      } catch (error) {
        console.error('评论数据获取失败:', error);
        throw error;
      }
    }

    // 渲染评论列表函数（支持嵌套子评论）
    function renderComments(container, comments) {
      if (!comments || comments.length === 0) {
        container.innerHTML = '<p>暂无评论</p>';
        return;
      }
      const commentsHTML = comments.map(comment => renderCommentItem(comment)).join('');
      container.innerHTML = commentsHTML;
    }

   // 递归生成单条评论及其子评论的 HTML
function renderCommentItem(comment, depth = 1) {
  let childHTML = '';
  if (comment.replies && comment.replies.length > 0) {
    // 如果是二级评论，不再递归生成子评论
    if (depth < 2) {
      childHTML = `
        <div class="child-comments ${depth === 1 ? 'collapsible' : ''}">
          ${comment.replies.map(reply => renderCommentItem(reply, depth + 1)).join('')}
        </div>
        ${depth === 1 ? `<div class="show-more-replies" onclick="toggleReplies(this)">
          <a href="javascript:void(0)">展开更多回复 <i class="bi bi-chevron-down"></i></a>
        </div>` : ''}
      `;
    } else {
      // 二级评论的回复直接追加到当前层级
      childHTML = `
        <div class="child-comments">
          ${comment.replies.map(reply => renderCommentItem(reply, depth)).join('')}
        </div>
      `;
    }
  }

  return `
    <div class="comment-item" data-comment-id="${comment.comment_id}">
      <div class="d-flex">
        <div class="user-avatar">
          <img src="${comment.avatar}" alt="用户头像">
        </div>
        <div class="comment-content">
          <div class="comment-header">
            <span class="username">${comment.username}</span>
            <span class="comment-time">${new Date(comment.created_at).toLocaleString()}</span>
          </div>
          <div class="comment-body">
            ${comment.content}
          </div>
          <div class="comment-actions mt-2 d-flex justify-content-end">
            <button class="btn-like" onclick="likeComment(${comment.comment_id}, this)">
              <i class="bi bi-hand-thumbs-up"></i>
              <span>${comment.likes || 0}</span>
            </button>
            <button class="btn-reply" onclick="showReplyForm(${comment.comment_id}, this, '${comment.username}')">回复</button>
          </div>
          <!-- 所有层级都可以显示回复表单 -->
          <div id="reply-form-${comment.comment_id}" class="mt-2" style="display: none;">
            <div class="form-group">
              <textarea class="form-control" placeholder="回复评论"></textarea>
            </div>
            <div class="form-group d-flex justify-content-end">
              <button class="btn btn-sm btn-primary mt-1" onclick="submitReply(${comment.comment_id}, this)">提交回复</button>
            </div>
          </div>
        </div>
      </div>
      ${childHTML}
    </div>
  `;
}

    // 显示回复表单（自动添加 @用户名）
    function showReplyForm(commentId, btn, username) {
      const formEl = document.getElementById(`reply-form-${commentId}`);
      const textarea = formEl.querySelector('textarea');
      if (username) {
        textarea.value = `@${username} `; // 自动添加 @用户名
      }
      formEl.style.display = formEl.style.display === 'none' ? 'block' : 'none';
    }

    // 切换子评论的折叠状态
    function toggleReplies(btn) {
      const childCommentsEl = btn.previousElementSibling;
      childCommentsEl.classList.toggle('expanded');

      const icon = btn.querySelector('i');
      if (childCommentsEl.classList.contains('expanded')) {
        btn.querySelector('a').textContent = '收起回复';
        icon.style.transform = 'rotate(180deg)';
      } else {
        btn.querySelector('a').textContent = '展开更多回复';
        icon.style.transform = 'rotate(0deg)';
      }
    }

    // 提交回复（刷新页面）
    async function submitReply(parentCommentId, btn) {
      const formEl = btn.parentElement.parentElement;
      const textarea = formEl.querySelector('textarea');
      const content = textarea.value.trim();
      if (!content) return;

      try {
        const csrfToken = getCSRFToken();
        const urlParams = new URLSearchParams(window.location.search);
        const article_id = urlParams.get('article_id');

        const response = await fetch('/article/replies', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': csrfToken,
          },
          body: JSON.stringify({
            article_id: article_id,
            content: content,
            parent_id: parentCommentId,
          }),
        });
        const result = await response.json();

        if (result.re_code === RET.OK) {
          // 提交成功后刷新页面
          location.reload();
        } else {
          alert(result.msg);
          throw new Error(result.msg || '提交回复失败');
        }
      } catch (error) {
        console.error('回复提交失败:', error);
        alert('回复提交失败，请稍后重试。');
      }
    }

    // 预置函数：在评论列表最前面添加新评论（简单实现）
    function prependComment(container, comment) {
      // const commentHTML = renderCommentItem(comment);
      // container.innerHTML = commentHTML + container.innerHTML;
      location.reload();
    }

    // 点赞评论（仅前端更新，支持后端存储）
    function likeComment(commentId, btn) {
      const span = btn.querySelector('span'); // 获取点赞数
      const icon = btn.querySelector('i'); // 获取图标
      let likes = parseInt(span.textContent, 10) || 0;

      btn.classList.toggle('active'); // 切换按钮的 active 类
      let isLiked = btn.classList.contains('active');

      // 点赞 +1，取消 -1
      likes = isLiked ? likes + 1 : likes - 1;
      span.textContent = likes;

      // 切换图标颜色
      icon.style.color = isLiked ? 'red' : 'gray';

      // 可选：调用后端 API 更新点赞状态
      updateLikeStatus(commentId, likes);
    }

    // 发送点赞数据到后端
    async function updateLikeStatus(commentId, likes) {
      try {
		 const csrfToken = getCSRFToken();
        // 发送请求
        const response = await fetch('/article/likes', {
          method: 'PUT',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRF-TOKEN': csrfToken
          },
          body: JSON.stringify({
          comment_id: commentId,
          likes: likes }),
        });

		// 解析响应数据
		const result = await response.json();

		if (result.re_code === RET.OK) {
		  // 提交成功后刷新页面
		  // location.reload();
		} else {
		  alert(result.msg);
		  throw new Error(result.msg || '点赞失败');
		}

      } catch (error) {
        // 捕获错误并输出
        console.error('请求失败:', error);
        throw error; // 抛出错误以便调用方处理
      }
    }

    // 发表评论函数
    async function postComment(article_id, content) {
      try {
        const csrfToken = getCSRFToken();
        const requestData = {
           article_id: article_id,
           content: content
        };
        const response = await fetch('/article/comments', {
          method: 'PUT',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRF-TOKEN': csrfToken
          },
          body: JSON.stringify(requestData)
        });
        const result = await response.json();
        if (result.re_code === RET.OK) {
          return result.comment; // 返回新评论对象
        } else {
          alert(result.msg)
          throw new Error(result.msg || '发表评论失败');
        }
      } catch (error) {
        console.error('发表评论失败:', error);
        throw error;
      }
    }

    // 渲染左边侧边栏
	  function renderLeftSidebar(container, data) {
	    let html = '';

	    // 作者信息
	    if (data.author) {
	      html += `
	        <div class="author-info">
	          <div style="display: flex; align-items: center; margin-bottom: 15px;">
	            <img src="${data.author.avatar}" alt="${data.author.username}">
	            <div>
	              <h3>${data.author.username}</h3>
	              <p>${data.author.bio || '暂无简介'}</p>
	            </div>
	          </div>
	          <div class="author-stats">
	            <div>
	              <p>${data.author.article_count}</p>
	              <small>文章数</small>
	            </div>
	            <div>
	              <p>${data.author.total_likes}</p>
	              <small>点赞数</small>
	            </div>
	            <div>
	              <p>${data.author.total_favorites}</p>
	              <small>收藏数</small>
	            </div>
	          </div>
	        </div>
	      `;
	    }

	    container.innerHTML = html;
	  }
  </script>
  <!-- Template Main JS File -->
  <script src="static/js/main.js"></script>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="static/vendor/aos/aos.js"></script>
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="static/vendor/php-email-form/validate.js"></script>
  <script src="static/vendor/swiper/swiper-bundle.min.js"></script>
</body>

</html>